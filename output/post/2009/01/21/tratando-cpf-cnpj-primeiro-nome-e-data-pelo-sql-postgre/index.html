<!DOCTYPE html>
<html lang="pt-BR ">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Vida e Tecnologia  | Tratando CPF, CNPJ, Primeiro Nome E Data Pelo SQL (Postgre)</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.59.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    
    
    <meta property="og:title" content="Tratando CPF, CNPJ, Primeiro Nome E Data Pelo SQL (Postgre)" />
<meta property="og:description" content="Olhando para os códigos php no trabalho, como tem sido de costume para averiguar erros e algoritmos que possa melhorar, me deparo em vários controllers com uma série de splits e loops para horas tratar o cpf, horas tratar o cnpj que vem do banco de dados.

No banco de dados estes campos estão salvos em um domínio String, e gravados sem pontuação ou dígitos. Então quando você quer mostrar para o usuário, para não deixar aquele emaranhado de números, você deixa as coisas como ele está acustumado a ver, com os pontos e etc.

Para não ficar repetindo a mesma rotina em vários locais do sistema, nem mesmo criar um método que eu tenha que chamar sempre que quiser um tratamento desses, já trago a coisa toda pronta no retorno da consulta. Simples, confira&#8230;

Trazendo o CPF com a pontuação e o dígito antes dos dois últimos numerais

title = &ldquo;tratando cpf cnpj primeiro nome e data pelo sql postgre&rdquo;
SUBSTR(cpf, 7, 3) || &lsquo;-&rsquo; || SUBSTR(cpf, 10) AS cpf
FROM e001_pessoas
WHERE pessoaid = 33;
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:1313/post/2009/01/21/tratando-cpf-cnpj-primeiro-nome-e-data-pelo-sql-postgre/" />
<meta property="article:published_time" content="2009-01-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2009-01-21T00:00:00+00:00" />
<meta itemprop="name" content="Tratando CPF, CNPJ, Primeiro Nome E Data Pelo SQL (Postgre)">
<meta itemprop="description" content="Olhando para os códigos php no trabalho, como tem sido de costume para averiguar erros e algoritmos que possa melhorar, me deparo em vários controllers com uma série de splits e loops para horas tratar o cpf, horas tratar o cnpj que vem do banco de dados.

No banco de dados estes campos estão salvos em um domínio String, e gravados sem pontuação ou dígitos. Então quando você quer mostrar para o usuário, para não deixar aquele emaranhado de números, você deixa as coisas como ele está acustumado a ver, com os pontos e etc.

Para não ficar repetindo a mesma rotina em vários locais do sistema, nem mesmo criar um método que eu tenha que chamar sempre que quiser um tratamento desses, já trago a coisa toda pronta no retorno da consulta. Simples, confira&#8230;

Trazendo o CPF com a pontuação e o dígito antes dos dois últimos numerais

title = &ldquo;tratando cpf cnpj primeiro nome e data pelo sql postgre&rdquo;
SUBSTR(cpf, 7, 3) || &lsquo;-&rsquo; || SUBSTR(cpf, 10) AS cpf
FROM e001_pessoas
WHERE pessoaid = 33;
">


<meta itemprop="datePublished" content="2009-01-21T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2009-01-21T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="795">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tratando CPF, CNPJ, Primeiro Nome E Data Pelo SQL (Postgre)"/>
<meta name="twitter:description" content="Olhando para os códigos php no trabalho, como tem sido de costume para averiguar erros e algoritmos que possa melhorar, me deparo em vários controllers com uma série de splits e loops para horas tratar o cpf, horas tratar o cnpj que vem do banco de dados.

No banco de dados estes campos estão salvos em um domínio String, e gravados sem pontuação ou dígitos. Então quando você quer mostrar para o usuário, para não deixar aquele emaranhado de números, você deixa as coisas como ele está acustumado a ver, com os pontos e etc.

Para não ficar repetindo a mesma rotina em vários locais do sistema, nem mesmo criar um método que eu tenha que chamar sempre que quiser um tratamento desses, já trago a coisa toda pronta no retorno da consulta. Simples, confira&#8230;

Trazendo o CPF com a pontuação e o dígito antes dos dois últimos numerais

title = &ldquo;tratando cpf cnpj primeiro nome e data pelo sql postgre&rdquo;
SUBSTR(cpf, 7, 3) || &lsquo;-&rsquo; || SUBSTR(cpf, 10) AS cpf
FROM e001_pessoas
WHERE pessoaid = 33;
"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="//localhost:1313/" class="f3 fw2 hover-white no-underline white-90 dib">
      Vida e Tecnologia
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Tratando CPF, CNPJ, Primeiro Nome E Data Pelo SQL (Postgre)</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2009-01-21T00:00:00Z">January 21, 2009</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Olhando para os códigos php no trabalho, como tem sido de costume para averiguar erros e algoritmos que possa melhorar, me deparo em vários controllers com uma série de <a href="http://br.php.net/manual/pt_BR/function.split.php">splits</a> e loops para horas tratar o cpf, horas tratar o cnpj que vem do banco de dados.</p>

<p>No banco de dados estes campos estão salvos em um domínio String, e gravados sem pontuação ou dígitos. Então quando você quer mostrar para o usuário, para não deixar aquele emaranhado de números, você deixa as coisas como ele está acustumado a ver, com os pontos e etc.</p>

<p>Para não ficar repetindo a mesma rotina em vários locais do sistema, nem mesmo criar um método que eu tenha que chamar sempre que quiser um tratamento desses, já trago a coisa toda pronta no retorno da consulta. Simples, confira&#8230;</p>

<p>Trazendo o CPF com a pontuação e o dígito antes dos dois últimos numerais</p>

<p>title = &ldquo;tratando cpf cnpj primeiro nome e data pelo sql postgre&rdquo;
SUBSTR(cpf, 7, 3) || &lsquo;-&rsquo; || SUBSTR(cpf, 10) AS cpf
FROM e001_pessoas
WHERE pessoaid = 33;
</pre></p>

<p> Explicação:</p>

<p>SELECT &#8211; estamos selecionando algo do banco SUBSTR &#8211; é uma função SQL, a mesma do PHP, a mesma do javascript que conhecemos, que serve para trazer parte de uma string.<br/>
Sintaxe &#8211; SUBSTR(campo, á partir de qual caracter começar, o máximo de caracteres a trazer) , sendo esse último opcional.</p>

<p>Então repare começo pegando do campo CPF, a partir do campo 1, 3 caracteres. Em seguida faço uma concatenação, que no SQL é feita com dois pipelines (||). Concateno com um ponto (está entre aspas pois é uma string).<br/>
Depois mais uma vez pego outro pedaço do campo cpf, dessa vez começando do 4° caracter. São mais 3 caracteres e mais uma concatenação com um ponto. Novamente mais um pedaço do cpf , começando do 7° caracter. São mais 3 caracteres e agora um dígito, o famoso <em>tracinho</em>.<br/>
Finalizo essa parte pegando o restante do CPF, que está a partir do caracter 10. Não limitei o número de caracteres nesse último, pois quero todo o restante.</p>

<p>Em seguida faço um ALIAS para o meu resultado, chamando de <em>&#8216;cpf&#8217;</em>. Caso você não o faça o nome do campo retornará como unknow ou com uma interrogação.<br/>
FROM &#8211; para indicar a tabela onde está o campo, que no meu caso é a <em>e001_pessoas</em>.<br/>
WHERE &#8211; para trazer apenas o cpf do registro <em>pessoaid = 33</em>.</p>

<p>Então a coisa toda é muito simples. Tenho meu cpf salvo no banco como um grande número. Pego 3 caracteres dele, concateno com um ponto, mais 3 caracteres, concateno a outro ponto, e assim por diante seguindo o <a href="http://en.wikipedia.org/wiki/File:Cpf2.jpg">modelo do cpf</a>.</p>

<p>Para o CNPJ funciona igual. Basta ver como é dividido o número do CNPJ, e ver quantos dígitos trazer, concatenar a que símbolo e assim por diante. Confira:</p>

<p>title = &ldquo;tratando cpf cnpj primeiro nome e data pelo sql postgre&rdquo;
SUBSTR(cnpj, 6, 3) || &lsquo;/&rsquo; || SUBSTR(cnpj, 9, 4) || &lsquo;-&rsquo; ||
SUBSTR(cnpj, 13) AS cnpj
FROM t020_clientes;
</pre></p>

<p>Acima trouxemos todos os CNPJ&#8217;s da tabela de clientes já com a devida pontuação e a coisa toda.</p>

<p>Uma outra situação é quando queremos mostrar apenas o primeiro nome da pessoa na tela. Novamente falando, você pode tratar isso onde quiser, mas o SQL pode fazer isso para você, então porque deixar isso passar&#8230;</p>

<p>title = &ldquo;tratando cpf cnpj primeiro nome e data pelo sql postgre&rdquo;
FROM e001_pessoas
WHERE pessoaid = 33;
</pre></p>

<p>Acima usamos a função do SQL, SPLIT_PART, que se assemelha muito a SPLIT do php e a SPLIT do javascript, dividindo a string em pedaços, de acordo com um separador comum.<br/>
Sintaxe &#8211; SPLIT_PART(campo que queremos dividir, separador entre as partes, parte que eu quero mostrar)</p>

<p>Então na SQL mostrada, a SPLIT_PART, separou o meu campo nome em partes, de acordo com o espaço em branco.<br/>
Exemplo: se o meu campo é &#8216;Maria Francisca Joana&#8217;, a função separou em 3 partes. 1 &#8211; Maria, 2 &#8211; Francisca e 3 &#8211; Joana.<br/>
Nó último parâmetro da função eu passo a parte que eu quero mostrar. No meu caso como quero apenas o primeiro nome, trago só a primeira parte.</p>

<p>Outro caso, esse já bem mais usado, é quando eu tenho um campo de domínio DATE, e quero trazer no resultado da consulta como uma string já com os separadores de dia, mês e ano.<br/>
Digamos que você queira trazer a data no seguinte formato DD/MM/AAAA.</p>

<p>title = &ldquo;tratando cpf cnpj primeiro nome e data pelo sql postgre&rdquo;
FROM e001_pessoas
WHERE pessoaid = 33;
</pre></p>

<p>Usando a função TO_CHAR você consegue isso.<br/>
Sintaxe &#8211; TO_CHAR(campo à transformar, formato que você quer).<br/>
Cuidado ! Repare no Y de Year, e não A de ano.</p>

<p>Experimente outras formatações. Deixem o SQL trabalhar por vocês.</p>

<p>Abraços!<br/>
Valeu !!!</p><ul class="pa0">
  
</ul>
<div class="mt6">
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="//localhost:1313/" >
    &copy; 2019 Vida e Tecnologia
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  <script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10&v=2"></' + 'script>')</script></body>
</html>
