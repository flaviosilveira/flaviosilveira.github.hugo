<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Vida e Tecnologia  | Habilitando Layouts No CodeIgniter (Template Engine) – Parte 2</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.59.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    
    
    <meta property="og:title" content="Habilitando Layouts No CodeIgniter (Template Engine) – Parte 2" />
<meta property="og:description" content="
  
    Atenção!! Este artigo foi escrito em cima da versão 1 do Codeigniter. Para detalhes de como usar com a versão 2 do framework clique aqui.
  


Continuando a parte 1 deste post.
Se você perdeu a primeira parte clique aqui para ler a primeira parte.

5 &#8211; Construindo sua View

Sua View deve ser feita normalmente, como voce já está acostumado a fazer, com o nome que você colocaria normalmente.
Apenas com o conteúdo que muda de uma página para outra.

O HTML que você colocar aqui na View irá substituir a variável {content_for_layout} que definimos no layout acima.
Vou colocar nessa nossa view de exemplo apenas um título e um parágrafo para demonstrar.
Ficando assim:

title = &ldquo;habilitando layouts no codeigniter template engine 2&rdquo;

&lt;p&gt;Paragrafo teste teste teste teste.&lt;/p&gt;



Chamei essa view de home.php.

6 &#8211; Desenvolvendo a Classe

Quando definimos nosso Hook no passo 2, setamos que a pasta onde ficaria nossa classe seria a pasta hooks que vem por padrão no projeto do CodeIgniter.

Vamos criar nossa classe dentro dessa pasta, e, com o nome que também especificamos na definição do Hook que foi Layout.php
Se você não seguiu o exemplo, faça suas devidas adaptações.

A classe é um pouco extensa, leia com atenção.
Para ajudar ela está com os comentários do próprio Mozart Petter." />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:1313/post/2010/habilitando-layouts-no-codeigniter-template-engine-2/" />
<meta property="article:published_time" content="2010-02-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2010-02-18T00:00:00+00:00" />
<meta itemprop="name" content="Habilitando Layouts No CodeIgniter (Template Engine) – Parte 2">
<meta itemprop="description" content="
  
    Atenção!! Este artigo foi escrito em cima da versão 1 do Codeigniter. Para detalhes de como usar com a versão 2 do framework clique aqui.
  


Continuando a parte 1 deste post.
Se você perdeu a primeira parte clique aqui para ler a primeira parte.

5 &#8211; Construindo sua View

Sua View deve ser feita normalmente, como voce já está acostumado a fazer, com o nome que você colocaria normalmente.
Apenas com o conteúdo que muda de uma página para outra.

O HTML que você colocar aqui na View irá substituir a variável {content_for_layout} que definimos no layout acima.
Vou colocar nessa nossa view de exemplo apenas um título e um parágrafo para demonstrar.
Ficando assim:

title = &ldquo;habilitando layouts no codeigniter template engine 2&rdquo;

&lt;p&gt;Paragrafo teste teste teste teste.&lt;/p&gt;



Chamei essa view de home.php.

6 &#8211; Desenvolvendo a Classe

Quando definimos nosso Hook no passo 2, setamos que a pasta onde ficaria nossa classe seria a pasta hooks que vem por padrão no projeto do CodeIgniter.

Vamos criar nossa classe dentro dessa pasta, e, com o nome que também especificamos na definição do Hook que foi Layout.php
Se você não seguiu o exemplo, faça suas devidas adaptações.

A classe é um pouco extensa, leia com atenção.
Para ajudar ela está com os comentários do próprio Mozart Petter.">


<meta itemprop="datePublished" content="2010-02-18T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2010-02-18T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1277">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Habilitando Layouts No CodeIgniter (Template Engine) – Parte 2"/>
<meta name="twitter:description" content="
  
    Atenção!! Este artigo foi escrito em cima da versão 1 do Codeigniter. Para detalhes de como usar com a versão 2 do framework clique aqui.
  


Continuando a parte 1 deste post.
Se você perdeu a primeira parte clique aqui para ler a primeira parte.

5 &#8211; Construindo sua View

Sua View deve ser feita normalmente, como voce já está acostumado a fazer, com o nome que você colocaria normalmente.
Apenas com o conteúdo que muda de uma página para outra.

O HTML que você colocar aqui na View irá substituir a variável {content_for_layout} que definimos no layout acima.
Vou colocar nessa nossa view de exemplo apenas um título e um parágrafo para demonstrar.
Ficando assim:

title = &ldquo;habilitando layouts no codeigniter template engine 2&rdquo;

&lt;p&gt;Paragrafo teste teste teste teste.&lt;/p&gt;



Chamei essa view de home.php.

6 &#8211; Desenvolvendo a Classe

Quando definimos nosso Hook no passo 2, setamos que a pasta onde ficaria nossa classe seria a pasta hooks que vem por padrão no projeto do CodeIgniter.

Vamos criar nossa classe dentro dessa pasta, e, com o nome que também especificamos na definição do Hook que foi Layout.php
Se você não seguiu o exemplo, faça suas devidas adaptações.

A classe é um pouco extensa, leia com atenção.
Para ajudar ela está com os comentários do próprio Mozart Petter."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="//localhost:1313/" class="f3 fw2 hover-white no-underline white-90 dib">
      Vida e Tecnologia
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Habilitando Layouts No CodeIgniter (Template Engine) – Parte 2</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2010-02-18T00:00:00Z">February 18, 2010</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><div id="atencao">
  <p>
    Atenção!! Este artigo foi escrito em cima da versão 1 do Codeigniter. Para detalhes de como usar com a versão 2 do framework <a href="http://flaviosilveira.com/2011/codeigniter-2-templates-e-layouts">clique aqui</a>.
  </p>
</div>

<p>Continuando a parte 1 deste post.<br/>
Se você perdeu a primeira parte <a href="http://flaviosilveira.com/2010/habilitando-layouts-no-codeigniter-template-engine-1">clique aqui para ler a primeira parte</a>.</p>

<p><strong>5 &#8211; Construindo sua View</strong></p>

<p>Sua View deve ser feita normalmente, como voce já está acostumado a fazer, com o nome que você colocaria normalmente.<br/>
Apenas com o conteúdo que muda de uma página para outra.</p>

<p>O HTML que você colocar aqui na View irá substituir a variável <em>{content_for_layout}</em> que definimos no layout acima.<br/>
Vou colocar nessa nossa view de exemplo apenas um título e um parágrafo para demonstrar.<br/>
Ficando assim:</p>

<p>title = &ldquo;habilitando layouts no codeigniter template engine 2&rdquo;</p>

<p>&lt;p&gt;Paragrafo teste teste teste teste.&lt;/p&gt;</p>

<p></pre></p>

<p>Chamei essa view de <em>home.php</em>.</p>

<p><strong>6 &#8211; Desenvolvendo a Classe</strong></p>

<p>Quando definimos nosso Hook no passo 2, setamos que a pasta onde ficaria nossa classe seria a pasta hooks que vem por padrão no projeto do CodeIgniter.</p>

<p>Vamos criar nossa classe dentro dessa pasta, e, com o nome que também especificamos na definição do Hook que foi Layout.php<br/>
Se você não seguiu o exemplo, faça suas devidas adaptações.</p>

<p>A classe é um pouco extensa, leia com atenção.<br/>
Para ajudar ela está com os comentários do próprio <a href="http://www.mozartpetter.com/pt/">Mozart Petter</a>.</p>

<p>title = &ldquo;habilitando layouts no codeigniter template engine 2&rdquo;
&lt;?php if (!defined(&lsquo;BASEPATH&rsquo;)) exit(&lsquo;No direct script access allowed&rsquo;);</p>

<p>/**
 * Layout Class
 *
 * @package hooks
 * @description Implementa as views do tipo layout no framework.
 */</p>

<p>class Layout
{</p>

<p>public $base_url;</p>

<p>/**
* Metodo que executa as implementacoes.
* Este metodo e chamado atraves do arquivo hooks.php
* na pasta config.
*
* @return
*/
public function init()
{
// Instancia do CI.
$CI =&amp; get_instance();</p>

<p>// Definindo o base_url.
$this-&gt;base_url = $CI-&gt;config-&gt;slash_item(&lsquo;base_url&rsquo;);</p>

<p>// Pegando a saida que o CI gera normalmente.
$output = $CI-&gt;output-&gt;get_output();</p>

<p>// Pegando o valor de title, se definido no controller.
$title = (isset($CI-&gt;title)) ? $CI-&gt;title : &ldquo;;</p>

<p>// Links CSS definidos no controlador.
$css = (isset($CI-&gt;css)) ? $this-&gt;createCSSLinks($CI-&gt;css) : &ldquo;;</p>

<p>// Links JS definidos no controlador.
$js = (isset($CI-&gt;js)) ? $this-&gt;createJSLinks($CI-&gt;js) : &ldquo;;</p>

<p>// Se layout estiver definido e a regexp nao bater.
if (isset($CI-&gt;layout) &amp;&amp; !preg_match(&lsquo;/(.+).php$/&rsquo;, $CI-&gt;layout))
{
$CI-&gt;layout .= &lsquo;.php&rsquo;;
}
else
{
$CI-&gt;layout = &lsquo;default.php&rsquo;;
}</p>

<p>// Definindo caminho completo do layout.
$layout = LAYOUTPATH . $CI-&gt;layout;</p>

<p>// Se o layout for diferente do default, e o arquivo nao existir.
if ($CI-&gt;layout !== &lsquo;default.php&rsquo; &amp;&amp; !file_exists($layout))
{
// Exibe a mensagem, se o layout for diferente de &lsquo;.php&rsquo;.
}</p>

<p>// Se o arquivo layout existir.
if (file_exists($layout))
{
// Carrega o conteudo do  arquivo.
$layout = $CI-&gt;load-&gt;file($layout, true);</p>

<p>// Substitui o texto {content_for_layout} pelo valor de output em layout.
$view = str_replace(&lsquo;{content_for_layout}&lsquo;, $output, $layout);</p>

<p>// Substitui o texto {title_for_layout} pelo valor de title em view.
$view = str_replace(&lsquo;{title_for_layout}&lsquo;, $title, $view);</p>

<p>// Links CSS.
$view = str_replace(&lsquo;{css_for_layout}&lsquo;, $css, $view);</p>

<p>// Links JS.
$view = str_replace(&lsquo;{js_for_layout}&lsquo;, $js, $view);
}
else
{
$view = $output;
}</p>

<p>echo $view;
}</p>

<p>/**
* Gera os links CSS utilizados no layout.
*
* @return void
*/
private function createCSSLinks($links)
{
$html = &ldquo;&rdquo;;</p>

<p>for ($i = 0; $i &lt; count($links); $i++)
{
$html .= &ldquo;&lt;link rel=&lsquo;stylesheet&rsquo; type=&lsquo;text/css&rsquo; href=&lsquo;&rdquo; . $this-&gt;base_url . CSSPATH . $links[$i] . &ldquo;.css&rsquo; media=&lsquo;screen&rsquo; /&gt;n&rdquo;;
}</p>

<p>return $html;</p>

<p>}</p>

<p>/**
* Gera os links JS utilizados no layout.
*
* @return void
*/
private function createJSLinks($links)
{
$html = &ldquo;&rdquo;;</p>

<p>for ($i = 0; $i &lt; count($links); $i++)
{
$html .= &ldquo;&lt;script type=&lsquo;text/javascript&rsquo; src=&lsquo;&rdquo; . $this-&gt;base_url . JSPATH . $links[$i] . &ldquo;.js&rsquo;&gt;&lt;/script&gt; n&rdquo;;
}</p>

<p>return $html;
}</p>

<p>}
</pre></p>

<p><strong>7 &#8211; Fazendo as chamadas no Controller</strong></p>

<p>Chegou o momento final!<br/>
É hora de juntar tudo isso que fizemos até agora.</p>

<p>A construção do seu controller é normal, como você está acostumado, mas temos que inserir algumas variáveis globais nele.</p>

<ul>
<li>Uma para o Layout default do controller, para que você não precise fazer a mesma definição várias vezes.</li>
<li>Uma para o título, onde você pode definir um default para todos as páginas que vão surgir desse controller mas, o interessante é estar um título por página.</li>
<li>Outra para guardar um Array dos CSS&#8217;s que você vai usar na página.</li>
<li>E por último, outro Array para guardar os JavaScripts que você vai usar na página.</li>
</ul>

<p>Vejamos como fica.<br/>
Acompanhe pelos comentários.</p>

<p>title = &ldquo;habilitando layouts no codeigniter template engine 2&rdquo;</p>

<p>/**
 *
 */
class Principal extends Controller
{</p>

<p>/**
* Layout default utilizado pelo controlador.
*/
public $layout = &lsquo;default&rsquo;;</p>

<p>/**
* Titulo default.
*/
public $title = &lsquo;::: Titulo default :::&lsquo;;</p>

<p>/**
* Definindo os css default.
*/
public $css = array(&lsquo;default&rsquo;);</p>

<p>/**
* Carregando os js default.
*/
public $js = array(&lsquo;home&rsquo;);</p>

<p>/**
* Construtora.
* @return
*/
function Principal()
{</p>

<p>parent::Controller();</p>

<p>}</p>

<p>// Metodoo index
function index()
{
// Carregando a view.
$this-&gt;load-&gt;view(&lsquo;home&rsquo;);
}</p>

<p>// Metodo teste
function teste()
{
//Title
$this-&gt;title = &lsquo;::: TESTE Título :::&lsquo;;</p>

<p>//CSS
$this-&gt;css = array(&lsquo;test&rsquo;);</p>

<p>//JS
$this-&gt;js = array(&lsquo;jquery&rsquo;);</p>

<p>// Carregando a View
$this-&gt;load-&gt;view(&lsquo;teste&rsquo;);
}</p>

<p>}</p>

<p>?&gt;</p>

<p></pre></p>

<p>Vamos reparar no seguinte.<br/>
Há dois métodos nesse controller que vão chamar páginas diferentes, o index e o teste.</p>

<p>Para o index não definimos nada de Layout, Titulo, CSS ou JS.<br/>
Ou seja, vai vir tudo do valor default que usamos quando definimos as variáveis globais.</p>

<p>Já no método teste, por algum motivo precisamos de um CSS, um JS e um Título diferente.<br/>
Então redefinimos esses valores no nosso método com o que precisamos.</p>

<p>A gente poderia ter definido um outro Layout caso tivesse a necessidade, da mesma forma com que fiz com esses valores.<br/>
Aí, claro, teria que criar um outro Layout na pasta layouts.</p>

<hr />

<p><span id="explicacao"> </span><br/>
<strong>UPDATE 20 DE NOVEMBRO DE 2010</strong><br/>
Detalhe importante observado pelo <a href="http://diegofelix.com.br/">Diego Felix</a> (<a href="http://twitter.com/diegofelix">@diegofelix</a>), que comentou esse detalhe abaixo nos comentários, no dia 16 de setembro desse mesmo ano.</p>

<p>&nbsp;</p>

<p>Eu tenho como costume em meus projetos com CI, retirar a pasta system no qual ele vem por padrão.<br/>
Faço então a alteração da variável <em>$system_folder</em> no arquivo de configuração e tudo segue sem problemas.</p>

<p>Exceto esse tutorial, que não leva em consideração essa pasta system.<br/>
Você tem duas opções para consertar isso:</p>

<p><strong>Primeiro:</strong><br/>
No local onde são definidas as variáveis contantes, adicionar sua pasta system antes de <em>$application_folder</em>.<br/>
Exemplo: <em>define(&#8216;LAYOUTPATH&#8217;, &#8216;system/&#8217; . $application_folder.&#8217;/layouts/&#8217;);</em></p>

<p>Particularmente acho essa solução acima atrasada, por deixar o projeto estático.<br/>
Se ocorrer de você alterar a pasta system, terá que alterar nesse local também. Chato.</p>

<p><strong>Segundo:</strong><br/>
Seguindo essa linha de raciocínio, de não deixar o projeto estático, prefiro fazer o seguinte:<br/>
No local onde são definidas as variáveis constantes, adicionar a variável <em>$system_folder</em>.<br/>
Exemplo: <em>define(&#8216;LAYOUTPATH&#8217;, $system_folder . &#8216;/&#8217; . $application_folder.&#8217;/layouts/&#8217;);</em></p>

<p>Mas há um detalhe.<br/>
No arquivo <em>index.php</em>, em torno da linha 53, é adicionado a variável <em>$system_folder</em> o seu caminho completo do servidor. Isso, claro, vai gerar problemas para o projeto.<br/>
O que eu faço então é pegar as variáveis constantes que usam a pasta system, e jogar antes desse bloco.<br/>
Se você seguir pelo projeto exemplo, verá que as coloquei logo depois do comentário <em>&#8220;END OF USER CONFIGURABLE SETTINGS&#8221;</em>.</p>

<p>Feito isso, caso você altera sua pasta system, basta alterar no local de sempre para o projeto continuar funcionando.</p>

<hr />

<p>Pessoal é isso!<br/>
Fazia tempo que queria escrever sobre isso, espero que ajude a galera por aí.<br/>
Dúvidas podem mandar sem problemas, vou responder no que estiver a meu alcance.</p>

<p>Se você teve dificuldades, <a href="../../assets/uploads/2010/02/projetoExemplo.zip" title="Baixar projeto Exemplo">baixe o projeto pronto aqui</a> e dê uma olhada mais de perto.</p>

<p>Agradeço novamente ao <a href="http://www.mozartpetter.com/pt/" title="Mozart Petter Developer">Mozart Petter</a>, grande Brother, que implementou essa solução que uso até hoje em meus projetos. E, como sempre, também ao pessoal que garante minhas 30 visitas diárias, Valeu!</p>

<p>É isso pessoal.<br/>
Até a próxima!!!</p><ul class="pa0">
  
</ul>
<div class="mt6">
      
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "flaviosilveira" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="//localhost:1313/" >
    &copy; 2020 Vida e Tecnologia
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  <script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10&v=2"></' + 'script>')</script></body>
</html>
